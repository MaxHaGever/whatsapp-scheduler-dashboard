<mat-card style="max-width: 900px; margin: 24px auto; padding: 16px;">
  <h2 style="margin-top: 0;">Onboarding</h2>

  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <mat-stepper linear #stepper>
    <!-- Step 1: Business -->
    <mat-step [completed]="businessForm.valid">
      <ng-template matStepLabel>Business Profile</ng-template>

      <form [formGroup]="businessForm" style="display: grid; gap: 12px; margin-top: 12px;">
        <mat-form-field appearance="outline">
          <mat-label>Business name</mat-label>
          <input matInput formControlName="name" placeholder="e.g., Max Dental Clinic" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Timezone</mat-label>
          <input matInput formControlName="timezone" placeholder="Asia/Jerusalem" />
        </mat-form-field>

        <div style="display: flex; justify-content: flex-end; gap: 12px;">
          <button mat-raised-button color="primary" (click)="saveBusinessAndContinue(stepper)" [disabled]="loading">
            Save & Continue
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Step 2: WhatsApp -->
    <mat-step>
      <ng-template matStepLabel>WhatsApp</ng-template>

      <div style="margin-top: 12px;">
        <p>
          Status:
          <strong>
            {{ whatsappStatus?.connected ? "Connected ✅" : "Not connected ❌" }}
          </strong>
        </p>

        <form [formGroup]="whatsappForm" style="display: grid; gap: 12px; margin-top: 12px;">
          <mat-form-field appearance="outline">
            <mat-label>WABA ID</mat-label>
            <input matInput formControlName="wabaId" placeholder="e.g., 1234567890" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Phone Number ID</mat-label>
            <input matInput formControlName="phoneNumberId" placeholder="e.g., 9876543210" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Access Token (Permanent recommended)</mat-label>
            <input matInput formControlName="accessToken" placeholder="EAAG..." />
          </mat-form-field>

          <div style="display: flex; justify-content: space-between; gap: 12px; align-items: center;">
            <button mat-button matStepperPrevious [disabled]="loading">Back</button>

            <button mat-raised-button color="primary" (click)="connectWhatsAppAndContinue(stepper)" [disabled]="loading">
              Save & Continue
            </button>
          </div>
        </form>

        <p style="margin-top: 16px; opacity: 0.8;">
          Tip: Your client can generate these in Meta → WhatsApp → API Setup. You can keep a manual flow now and later add Embedded Signup.
        </p>
      </div>
    </mat-step>

    <!-- Step 3: Google -->
    <mat-step>
      <ng-template matStepLabel>Google Calendar</ng-template>

      <div style="margin-top: 12px;">
        <p>
          Status:
          <strong>
            {{ calendarStatus?.connected ? "Connected ✅" : "Not connected ❌" }}
          </strong>
        </p>

        <div style="display: flex; justify-content: space-between; gap: 12px; margin-top: 16px;">
          <button mat-button matStepperPrevious [disabled]="loading">Back</button>

          <button mat-raised-button color="primary" (click)="connectGoogle()" [disabled]="loading">
            Connect Google
          </button>
        </div>
      </div>
    </mat-step>

    <!-- Step 4: Finish -->
    <mat-step>
      <ng-template matStepLabel>Finish</ng-template>

      <div style="margin-top: 12px;">
        <p>All set. You can now use the dashboard.</p>

        <div style="display: flex; justify-content: space-between; gap: 12px;">
          <button mat-button matStepperPrevious [disabled]="loading">Back</button>
          <button mat-raised-button color="primary" (click)="finish()" [disabled]="loading">
            Finish
          </button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</mat-card>
